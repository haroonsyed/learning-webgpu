(()=>{"use strict";var t={72:(t,e,n)=>{n.r(e),n.d(e,{glMatrix:()=>r,mat2:()=>a,mat2d:()=>i,mat3:()=>o,mat4:()=>s,quat:()=>h,quat2:()=>f,vec2:()=>l,vec3:()=>u,vec4:()=>c});var r={};n.r(r),n.d(r,{ARRAY_TYPE:()=>v,EPSILON:()=>d,RANDOM:()=>m,equals:()=>b,setMatrixArrayType:()=>p,toRadian:()=>_});var a={};n.r(a),n.d(a,{LDU:()=>U,add:()=>L,adjoint:()=>O,clone:()=>y,copy:()=>x,create:()=>g,determinant:()=>A,equals:()=>F,exactEquals:()=>G,frob:()=>k,fromRotation:()=>C,fromScaling:()=>j,fromValues:()=>w,identity:()=>E,invert:()=>T,mul:()=>B,multiply:()=>R,multiplyScalar:()=>z,multiplyScalarAndAdd:()=>V,rotate:()=>D,scale:()=>q,set:()=>P,str:()=>N,sub:()=>X,subtract:()=>I,transpose:()=>S});var i={};n.r(i),n.d(i,{add:()=>ct,clone:()=>W,copy:()=>Z,create:()=>Y,determinant:()=>K,equals:()=>vt,exactEquals:()=>dt,frob:()=>ut,fromRotation:()=>at,fromScaling:()=>it,fromTranslation:()=>ot,fromValues:()=>Q,identity:()=>H,invert:()=>J,mul:()=>mt,multiply:()=>tt,multiplyScalar:()=>ft,multiplyScalarAndAdd:()=>lt,rotate:()=>et,scale:()=>nt,set:()=>$,str:()=>st,sub:()=>pt,subtract:()=>ht,translate:()=>rt});var o={};n.r(o),n.d(o,{add:()=>Ft,adjoint:()=>St,clone:()=>bt,copy:()=>gt,create:()=>Mt,determinant:()=>Tt,equals:()=>Yt,exactEquals:()=>Xt,frob:()=>Gt,fromMat2d:()=>Nt,fromMat4:()=>_t,fromQuat:()=>kt,fromRotation:()=>Ct,fromScaling:()=>jt,fromTranslation:()=>qt,fromValues:()=>yt,identity:()=>Et,invert:()=>Pt,mul:()=>Wt,multiply:()=>Ot,multiplyScalar:()=>Vt,multiplyScalarAndAdd:()=>Bt,normalFromMat4:()=>Ut,projection:()=>Lt,rotate:()=>Rt,scale:()=>Dt,set:()=>xt,str:()=>It,sub:()=>Zt,subtract:()=>zt,translate:()=>At,transpose:()=>wt});var s={};n.r(s),n.d(s,{add:()=>Le,adjoint:()=>re,clone:()=>Qt,copy:()=>$t,create:()=>Ht,determinant:()=>ae,equals:()=>Ve,exactEquals:()=>ze,frob:()=>Ue,fromQuat:()=>Pe,fromQuat2:()=>be,fromRotation:()=>ve,fromRotationTranslation:()=>_e,fromRotationTranslationScale:()=>Ee,fromRotationTranslationScaleOrigin:()=>we,fromScaling:()=>de,fromTranslation:()=>le,fromValues:()=>Jt,fromXRotation:()=>me,fromYRotation:()=>pe,fromZRotation:()=>Me,frustum:()=>Se,getRotation:()=>xe,getScaling:()=>ye,getTranslation:()=>ge,identity:()=>te,invert:()=>ne,lookAt:()=>je,mul:()=>Be,multiply:()=>ie,multiplyScalar:()=>Ge,multiplyScalarAndAdd:()=>Fe,ortho:()=>qe,orthoNO:()=>De,orthoZO:()=>Ce,perspective:()=>Oe,perspectiveFromFieldOfView:()=>Re,perspectiveNO:()=>Te,perspectiveZO:()=>Ae,rotate:()=>ue,rotateX:()=>ce,rotateY:()=>he,rotateZ:()=>fe,scale:()=>se,set:()=>Kt,str:()=>ke,sub:()=>Xe,subtract:()=>Ie,targetTo:()=>Ne,translate:()=>oe,transpose:()=>ee});var u={};n.r(u),n.d(u,{add:()=>Je,angle:()=>On,bezier:()=>gn,ceil:()=>nn,clone:()=>We,copy:()=>Qe,create:()=>Ye,cross:()=>Mn,dist:()=>Un,distance:()=>hn,div:()=>kn,divide:()=>en,dot:()=>pn,equals:()=>qn,exactEquals:()=>Dn,floor:()=>rn,forEach:()=>Fn,fromValues:()=>He,hermite:()=>bn,inverse:()=>vn,len:()=>In,length:()=>Ze,lerp:()=>_n,max:()=>on,min:()=>an,mul:()=>Nn,multiply:()=>tn,negate:()=>dn,normalize:()=>mn,random:()=>yn,rotateX:()=>Pn,rotateY:()=>Sn,rotateZ:()=>Tn,round:()=>sn,scale:()=>un,scaleAndAdd:()=>cn,set:()=>$e,sqrDist:()=>Ln,sqrLen:()=>Gn,squaredDistance:()=>fn,squaredLength:()=>ln,str:()=>Rn,sub:()=>jn,subtract:()=>Ke,transformMat3:()=>En,transformMat4:()=>xn,transformQuat:()=>wn,zero:()=>An});var c={};n.r(c),n.d(c,{add:()=>Wn,ceil:()=>$n,clone:()=>Vn,copy:()=>Xn,create:()=>zn,cross:()=>lr,dist:()=>wr,distance:()=>ar,div:()=>Er,divide:()=>Qn,dot:()=>fr,equals:()=>gr,exactEquals:()=>br,floor:()=>Jn,forEach:()=>Or,fromValues:()=>Bn,inverse:()=>cr,len:()=>Sr,length:()=>or,lerp:()=>dr,max:()=>tr,min:()=>Kn,mul:()=>xr,multiply:()=>Hn,negate:()=>ur,normalize:()=>hr,random:()=>vr,round:()=>er,scale:()=>nr,scaleAndAdd:()=>rr,set:()=>Yn,sqrDist:()=>Pr,sqrLen:()=>Tr,squaredDistance:()=>ir,squaredLength:()=>sr,str:()=>_r,sub:()=>yr,subtract:()=>Zn,transformMat4:()=>mr,transformQuat:()=>pr,zero:()=>Mr});var h={};n.r(h),n.d(h,{add:()=>ia,calculateW:()=>Lr,clone:()=>ea,conjugate:()=>Xr,copy:()=>ra,create:()=>Ar,dot:()=>ua,equals:()=>pa,exactEquals:()=>ma,exp:()=>Ir,fromEuler:()=>Wr,fromMat3:()=>Yr,fromValues:()=>na,getAngle:()=>Cr,getAxisAngle:()=>qr,identity:()=>Rr,invert:()=>Br,len:()=>fa,length:()=>ha,lerp:()=>ca,ln:()=>Gr,mul:()=>oa,multiply:()=>jr,normalize:()=>va,pow:()=>Fr,random:()=>Vr,rotateX:()=>Nr,rotateY:()=>kr,rotateZ:()=>Ur,rotationTo:()=>Ma,scale:()=>sa,set:()=>aa,setAxes:()=>ba,setAxisAngle:()=>Dr,slerp:()=>zr,sqlerp:()=>_a,sqrLen:()=>da,squaredLength:()=>la,str:()=>Zr});var f={};n.r(f),n.d(f,{add:()=>Va,clone:()=>ya,conjugate:()=>Qa,copy:()=>Oa,create:()=>ga,dot:()=>Wa,equals:()=>ai,exactEquals:()=>ri,fromMat4:()=>Ta,fromRotation:()=>Sa,fromRotationTranslation:()=>wa,fromRotationTranslationValues:()=>Ea,fromTranslation:()=>Pa,fromValues:()=>xa,getDual:()=>qa,getReal:()=>Da,getTranslation:()=>Na,identity:()=>Aa,invert:()=>Ha,len:()=>Ja,length:()=>$a,lerp:()=>Za,mul:()=>Xa,multiply:()=>Ba,normalize:()=>ei,rotateAroundAxis:()=>za,rotateByQuatAppend:()=>Ga,rotateByQuatPrepend:()=>Fa,rotateX:()=>Ua,rotateY:()=>La,rotateZ:()=>Ia,scale:()=>Ya,set:()=>Ra,setDual:()=>ja,setReal:()=>Ca,sqrLen:()=>ti,squaredLength:()=>Ka,str:()=>ni,translate:()=>ka});var l={};n.r(l),n.d(l,{add:()=>hi,angle:()=>Ui,ceil:()=>vi,clone:()=>oi,copy:()=>ui,create:()=>ii,cross:()=>Ai,dist:()=>Yi,distance:()=>yi,div:()=>Xi,divide:()=>di,dot:()=>Oi,equals:()=>Fi,exactEquals:()=>Gi,floor:()=>mi,forEach:()=>Hi,fromValues:()=>si,inverse:()=>Si,len:()=>zi,length:()=>Ei,lerp:()=>Ri,max:()=>Mi,min:()=>pi,mul:()=>Bi,multiply:()=>li,negate:()=>Pi,normalize:()=>Ti,random:()=>Di,rotate:()=>ki,round:()=>_i,scale:()=>bi,scaleAndAdd:()=>gi,set:()=>ci,sqrDist:()=>Wi,sqrLen:()=>Zi,squaredDistance:()=>xi,squaredLength:()=>wi,str:()=>Ii,sub:()=>Vi,subtract:()=>fi,transformMat2:()=>qi,transformMat2d:()=>Ci,transformMat3:()=>ji,transformMat4:()=>Ni,zero:()=>Li});var d=1e-6,v="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function p(t){v=t}var M=Math.PI/180;function _(t){return t*M}function b(t,e){return Math.abs(t-e)<=d*Math.max(1,Math.abs(t),Math.abs(e))}function g(){var t=new v(4);return v!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function y(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function E(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function w(t,e,n,r){var a=new v(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function P(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t}function S(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function T(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n*i-a*r;return o?(o=1/o,t[0]=i*o,t[1]=-r*o,t[2]=-a*o,t[3]=n*o,t):null}function O(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function A(t){return t[0]*t[3]-t[2]*t[1]}function R(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*s+i*u,t[1]=a*s+o*u,t[2]=r*c+i*h,t[3]=a*c+o*h,t}function D(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=a*u+o*s,t[2]=r*-s+i*u,t[3]=a*-s+o*u,t}function q(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=a*s,t[2]=i*u,t[3]=o*u,t}function C(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function j(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function N(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function k(t){return Math.hypot(t[0],t[1],t[2],t[3])}function U(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function L(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function I(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function G(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function F(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-o)<=d*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-u)<=d*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))}function z(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function V(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var B=R,X=I;function Y(){var t=new v(6);return v!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function W(t){var e=new v(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Z(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function H(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Q(t,e,n,r,a,i){var o=new v(6);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o[4]=a,o[5]=i,o}function $(t,e,n,r,a,i,o){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t}function J(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=n*i-r*a;return u?(u=1/u,t[0]=i*u,t[1]=-r*u,t[2]=-a*u,t[3]=n*u,t[4]=(a*s-i*o)*u,t[5]=(r*o-n*s)*u,t):null}function K(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=n[0],h=n[1],f=n[2],l=n[3],d=n[4],v=n[5];return t[0]=r*c+i*h,t[1]=a*c+o*h,t[2]=r*f+i*l,t[3]=a*f+o*l,t[4]=r*d+i*v+s,t[5]=a*d+o*v+u,t}function et(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=Math.sin(n),h=Math.cos(n);return t[0]=r*h+i*c,t[1]=a*h+o*c,t[2]=r*-c+i*h,t[3]=a*-c+o*h,t[4]=s,t[5]=u,t}function nt(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r*c,t[1]=a*c,t[2]=i*h,t[3]=o*h,t[4]=s,t[5]=u,t}function rt(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=r*c+i*h+s,t[5]=a*c+o*h+u,t}function at(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function it(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ct(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function ht(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function ft(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function lt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function dt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function vt(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=e[0],c=e[1],h=e[2],f=e[3],l=e[4],v=e[5];return Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=d*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-h)<=d*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-f)<=d*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-l)<=d*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(s-v)<=d*Math.max(1,Math.abs(s),Math.abs(v))}var mt=tt,pt=ht;function Mt(){var t=new v(9);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function bt(t){var e=new v(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function gt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function yt(t,e,n,r,a,i,o,s,u){var c=new v(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=a,c[5]=i,c[6]=o,c[7]=s,c[8]=u,c}function xt(t,e,n,r,a,i,o,s,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=u,t[8]=c,t}function Et(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wt(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Pt(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=h*o-s*c,l=-h*i+s*u,d=c*i-o*u,v=n*f+r*l+a*d;return v?(v=1/v,t[0]=f*v,t[1]=(-h*r+a*c)*v,t[2]=(s*r-a*o)*v,t[3]=l*v,t[4]=(h*n-a*u)*v,t[5]=(-s*n+a*i)*v,t[6]=d*v,t[7]=(-c*n+r*u)*v,t[8]=(o*n-r*i)*v,t):null}function St(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8];return t[0]=o*h-s*c,t[1]=a*c-r*h,t[2]=r*s-a*o,t[3]=s*u-i*h,t[4]=n*h-a*u,t[5]=a*i-n*s,t[6]=i*c-o*u,t[7]=r*u-n*c,t[8]=n*o-r*i,t}function Tt(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],o=t[5],s=t[6],u=t[7],c=t[8];return e*(c*i-o*u)+n*(-c*a+o*s)+r*(u*a-i*s)}function Ot(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=n[0],d=n[1],v=n[2],m=n[3],p=n[4],M=n[5],_=n[6],b=n[7],g=n[8];return t[0]=l*r+d*o+v*c,t[1]=l*a+d*s+v*h,t[2]=l*i+d*u+v*f,t[3]=m*r+p*o+M*c,t[4]=m*a+p*s+M*h,t[5]=m*i+p*u+M*f,t[6]=_*r+b*o+g*c,t[7]=_*a+b*s+g*h,t[8]=_*i+b*u+g*f,t}function At(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=n[0],d=n[1];return t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=u,t[6]=l*r+d*o+c,t[7]=l*a+d*s+h,t[8]=l*i+d*u+f,t}function Rt(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=Math.sin(n),d=Math.cos(n);return t[0]=d*r+l*o,t[1]=d*a+l*s,t[2]=d*i+l*u,t[3]=d*o-l*r,t[4]=d*s-l*a,t[5]=d*u-l*i,t[6]=c,t[7]=h,t[8]=f,t}function Dt(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function qt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Ct(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function jt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Nt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function kt(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n+n,s=r+r,u=a+a,c=n*o,h=r*o,f=r*s,l=a*o,d=a*s,v=a*u,m=i*o,p=i*s,M=i*u;return t[0]=1-f-v,t[3]=h-M,t[6]=l+p,t[1]=h+M,t[4]=1-c-v,t[7]=d-m,t[2]=l-p,t[5]=d+m,t[8]=1-c-f,t}function Ut(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],d=e[11],v=e[12],m=e[13],p=e[14],M=e[15],_=n*s-r*o,b=n*u-a*o,g=n*c-i*o,y=r*u-a*s,x=r*c-i*s,E=a*c-i*u,w=h*m-f*v,P=h*p-l*v,S=h*M-d*v,T=f*p-l*m,O=f*M-d*m,A=l*M-d*p,R=_*A-b*O+g*T+y*S-x*P+E*w;return R?(R=1/R,t[0]=(s*A-u*O+c*T)*R,t[1]=(u*S-o*A-c*P)*R,t[2]=(o*O-s*S+c*w)*R,t[3]=(a*O-r*A-i*T)*R,t[4]=(n*A-a*S+i*P)*R,t[5]=(r*S-n*O-i*w)*R,t[6]=(m*E-p*x+M*y)*R,t[7]=(p*g-v*E-M*b)*R,t[8]=(v*x-m*g+M*_)*R,t):null}function Lt(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function It(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Gt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ft(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function zt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Vt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Bt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Xt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Yt(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=e[0],l=e[1],v=e[2],m=e[3],p=e[4],M=e[5],_=e[6],b=e[7],g=e[8];return Math.abs(n-f)<=d*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-l)<=d*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-v)<=d*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-m)<=d*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(o-p)<=d*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-M)<=d*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-_)<=d*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-b)<=d*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(h-g)<=d*Math.max(1,Math.abs(h),Math.abs(g))}var Wt=Ot,Zt=zt;function Ht(){var t=new v(16);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Qt(t){var e=new v(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Jt(t,e,n,r,a,i,o,s,u,c,h,f,l,d,m,p){var M=new v(16);return M[0]=t,M[1]=e,M[2]=n,M[3]=r,M[4]=a,M[5]=i,M[6]=o,M[7]=s,M[8]=u,M[9]=c,M[10]=h,M[11]=f,M[12]=l,M[13]=d,M[14]=m,M[15]=p,M}function Kt(t,e,n,r,a,i,o,s,u,c,h,f,l,d,v,m,p){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=f,t[11]=l,t[12]=d,t[13]=v,t[14]=m,t[15]=p,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],i=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ne(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],d=e[11],v=e[12],m=e[13],p=e[14],M=e[15],_=n*s-r*o,b=n*u-a*o,g=n*c-i*o,y=r*u-a*s,x=r*c-i*s,E=a*c-i*u,w=h*m-f*v,P=h*p-l*v,S=h*M-d*v,T=f*p-l*m,O=f*M-d*m,A=l*M-d*p,R=_*A-b*O+g*T+y*S-x*P+E*w;return R?(R=1/R,t[0]=(s*A-u*O+c*T)*R,t[1]=(a*O-r*A-i*T)*R,t[2]=(m*E-p*x+M*y)*R,t[3]=(l*x-f*E-d*y)*R,t[4]=(u*S-o*A-c*P)*R,t[5]=(n*A-a*S+i*P)*R,t[6]=(p*g-v*E-M*b)*R,t[7]=(h*E-l*g+d*b)*R,t[8]=(o*O-s*S+c*w)*R,t[9]=(r*S-n*O-i*w)*R,t[10]=(v*x-m*g+M*_)*R,t[11]=(f*g-h*x-d*_)*R,t[12]=(s*P-o*T-u*w)*R,t[13]=(n*T-r*P+a*w)*R,t[14]=(m*b-v*y-p*_)*R,t[15]=(h*y-f*b+l*_)*R,t):null}function re(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],d=e[11],v=e[12],m=e[13],p=e[14],M=e[15];return t[0]=s*(l*M-d*p)-f*(u*M-c*p)+m*(u*d-c*l),t[1]=-(r*(l*M-d*p)-f*(a*M-i*p)+m*(a*d-i*l)),t[2]=r*(u*M-c*p)-s*(a*M-i*p)+m*(a*c-i*u),t[3]=-(r*(u*d-c*l)-s*(a*d-i*l)+f*(a*c-i*u)),t[4]=-(o*(l*M-d*p)-h*(u*M-c*p)+v*(u*d-c*l)),t[5]=n*(l*M-d*p)-h*(a*M-i*p)+v*(a*d-i*l),t[6]=-(n*(u*M-c*p)-o*(a*M-i*p)+v*(a*c-i*u)),t[7]=n*(u*d-c*l)-o*(a*d-i*l)+h*(a*c-i*u),t[8]=o*(f*M-d*m)-h*(s*M-c*m)+v*(s*d-c*f),t[9]=-(n*(f*M-d*m)-h*(r*M-i*m)+v*(r*d-i*f)),t[10]=n*(s*M-c*m)-o*(r*M-i*m)+v*(r*c-i*s),t[11]=-(n*(s*d-c*f)-o*(r*d-i*f)+h*(r*c-i*s)),t[12]=-(o*(f*p-l*m)-h*(s*p-u*m)+v*(s*l-u*f)),t[13]=n*(f*p-l*m)-h*(r*p-a*m)+v*(r*l-a*f),t[14]=-(n*(s*p-u*m)-o*(r*p-a*m)+v*(r*u-a*s)),t[15]=n*(s*l-u*f)-o*(r*l-a*f)+h*(r*u-a*s),t}function ae(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],f=t[10],l=t[11],d=t[12],v=t[13],m=t[14],p=t[15];return(e*o-n*i)*(f*p-l*m)-(e*s-r*i)*(h*p-l*v)+(e*u-a*i)*(h*m-f*v)+(n*s-r*o)*(c*p-l*d)-(n*u-a*o)*(c*m-f*d)+(r*u-a*s)*(c*v-h*d)}function ie(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=e[9],d=e[10],v=e[11],m=e[12],p=e[13],M=e[14],_=e[15],b=n[0],g=n[1],y=n[2],x=n[3];return t[0]=b*r+g*s+y*f+x*m,t[1]=b*a+g*u+y*l+x*p,t[2]=b*i+g*c+y*d+x*M,t[3]=b*o+g*h+y*v+x*_,b=n[4],g=n[5],y=n[6],x=n[7],t[4]=b*r+g*s+y*f+x*m,t[5]=b*a+g*u+y*l+x*p,t[6]=b*i+g*c+y*d+x*M,t[7]=b*o+g*h+y*v+x*_,b=n[8],g=n[9],y=n[10],x=n[11],t[8]=b*r+g*s+y*f+x*m,t[9]=b*a+g*u+y*l+x*p,t[10]=b*i+g*c+y*d+x*M,t[11]=b*o+g*h+y*v+x*_,b=n[12],g=n[13],y=n[14],x=n[15],t[12]=b*r+g*s+y*f+x*m,t[13]=b*a+g*u+y*l+x*p,t[14]=b*i+g*c+y*d+x*M,t[15]=b*o+g*h+y*v+x*_,t}function oe(t,e,n){var r,a,i,o,s,u,c,h,f,l,d,v,m=n[0],p=n[1],M=n[2];return e===t?(t[12]=e[0]*m+e[4]*p+e[8]*M+e[12],t[13]=e[1]*m+e[5]*p+e[9]*M+e[13],t[14]=e[2]*m+e[6]*p+e[10]*M+e[14],t[15]=e[3]*m+e[7]*p+e[11]*M+e[15]):(r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=e[8],l=e[9],d=e[10],v=e[11],t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=f,t[9]=l,t[10]=d,t[11]=v,t[12]=r*m+s*p+f*M+e[12],t[13]=a*m+u*p+l*M+e[13],t[14]=i*m+c*p+d*M+e[14],t[15]=o*m+h*p+v*M+e[15]),t}function se(t,e,n){var r=n[0],a=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ue(t,e,n,r){var a,i,o,s,u,c,h,f,l,v,m,p,M,_,b,g,y,x,E,w,P,S,T,O,A=r[0],R=r[1],D=r[2],q=Math.hypot(A,R,D);return q<d?null:(A*=q=1/q,R*=q,D*=q,a=Math.sin(n),o=1-(i=Math.cos(n)),s=e[0],u=e[1],c=e[2],h=e[3],f=e[4],l=e[5],v=e[6],m=e[7],p=e[8],M=e[9],_=e[10],b=e[11],g=A*A*o+i,y=R*A*o+D*a,x=D*A*o-R*a,E=A*R*o-D*a,w=R*R*o+i,P=D*R*o+A*a,S=A*D*o+R*a,T=R*D*o-A*a,O=D*D*o+i,t[0]=s*g+f*y+p*x,t[1]=u*g+l*y+M*x,t[2]=c*g+v*y+_*x,t[3]=h*g+m*y+b*x,t[4]=s*E+f*w+p*P,t[5]=u*E+l*w+M*P,t[6]=c*E+v*w+_*P,t[7]=h*E+m*w+b*P,t[8]=s*S+f*T+p*O,t[9]=u*S+l*T+M*O,t[10]=c*S+v*T+_*O,t[11]=h*S+m*T+b*O,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ce(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],h=e[9],f=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+c*r,t[5]=o*a+h*r,t[6]=s*a+f*r,t[7]=u*a+l*r,t[8]=c*a-i*r,t[9]=h*a-o*r,t[10]=f*a-s*r,t[11]=l*a-u*r,t}function he(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],o=e[1],s=e[2],u=e[3],c=e[8],h=e[9],f=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-c*r,t[1]=o*a-h*r,t[2]=s*a-f*r,t[3]=u*a-l*r,t[8]=i*r+c*a,t[9]=o*r+h*a,t[10]=s*r+f*a,t[11]=u*r+l*a,t}function fe(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],o=e[1],s=e[2],u=e[3],c=e[4],h=e[5],f=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+c*r,t[1]=o*a+h*r,t[2]=s*a+f*r,t[3]=u*a+l*r,t[4]=c*a-i*r,t[5]=h*a-o*r,t[6]=f*a-s*r,t[7]=l*a-u*r,t}function le(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function de(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ve(t,e,n){var r,a,i,o=n[0],s=n[1],u=n[2],c=Math.hypot(o,s,u);return c<d?null:(o*=c=1/c,s*=c,u*=c,r=Math.sin(e),i=1-(a=Math.cos(e)),t[0]=o*o*i+a,t[1]=s*o*i+u*r,t[2]=u*o*i-s*r,t[3]=0,t[4]=o*s*i-u*r,t[5]=s*s*i+a,t[6]=u*s*i+o*r,t[7]=0,t[8]=o*u*i+s*r,t[9]=s*u*i-o*r,t[10]=u*u*i+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pe(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _e(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=r+r,u=a+a,c=i+i,h=r*s,f=r*u,l=r*c,d=a*u,v=a*c,m=i*c,p=o*s,M=o*u,_=o*c;return t[0]=1-(d+m),t[1]=f+_,t[2]=l-M,t[3]=0,t[4]=f-_,t[5]=1-(h+m),t[6]=v+p,t[7]=0,t[8]=l+M,t[9]=v-p,t[10]=1-(h+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function be(t,e){var n=new v(3),r=-e[0],a=-e[1],i=-e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=r*r+a*a+i*i+o*o;return f>0?(n[0]=2*(s*o+h*r+u*i-c*a)/f,n[1]=2*(u*o+h*a+c*r-s*i)/f,n[2]=2*(c*o+h*i+s*a-u*r)/f):(n[0]=2*(s*o+h*r+u*i-c*a),n[1]=2*(u*o+h*a+c*r-s*i),n[2]=2*(c*o+h*i+s*a-u*r)),_e(t,e,n),t}function ge(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ye(t,e){var n=e[0],r=e[1],a=e[2],i=e[4],o=e[5],s=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(i,o,s),t[2]=Math.hypot(u,c,h),t}function xe(t,e){var n=new v(3);ye(n,e);var r=1/n[0],a=1/n[1],i=1/n[2],o=e[0]*r,s=e[1]*a,u=e[2]*i,c=e[4]*r,h=e[5]*a,f=e[6]*i,l=e[8]*r,d=e[9]*a,m=e[10]*i,p=o+h+m,M=0;return p>0?(M=2*Math.sqrt(p+1),t[3]=.25*M,t[0]=(f-d)/M,t[1]=(l-u)/M,t[2]=(s-c)/M):o>h&&o>m?(M=2*Math.sqrt(1+o-h-m),t[3]=(f-d)/M,t[0]=.25*M,t[1]=(s+c)/M,t[2]=(l+u)/M):h>m?(M=2*Math.sqrt(1+h-o-m),t[3]=(l-u)/M,t[0]=(s+c)/M,t[1]=.25*M,t[2]=(f+d)/M):(M=2*Math.sqrt(1+m-o-h),t[3]=(s-c)/M,t[0]=(l+u)/M,t[1]=(f+d)/M,t[2]=.25*M),t}function Ee(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=e[3],u=a+a,c=i+i,h=o+o,f=a*u,l=a*c,d=a*h,v=i*c,m=i*h,p=o*h,M=s*u,_=s*c,b=s*h,g=r[0],y=r[1],x=r[2];return t[0]=(1-(v+p))*g,t[1]=(l+b)*g,t[2]=(d-_)*g,t[3]=0,t[4]=(l-b)*y,t[5]=(1-(f+p))*y,t[6]=(m+M)*y,t[7]=0,t[8]=(d+_)*x,t[9]=(m-M)*x,t[10]=(1-(f+v))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function we(t,e,n,r,a){var i=e[0],o=e[1],s=e[2],u=e[3],c=i+i,h=o+o,f=s+s,l=i*c,d=i*h,v=i*f,m=o*h,p=o*f,M=s*f,_=u*c,b=u*h,g=u*f,y=r[0],x=r[1],E=r[2],w=a[0],P=a[1],S=a[2],T=(1-(m+M))*y,O=(d+g)*y,A=(v-b)*y,R=(d-g)*x,D=(1-(l+M))*x,q=(p+_)*x,C=(v+b)*E,j=(p-_)*E,N=(1-(l+m))*E;return t[0]=T,t[1]=O,t[2]=A,t[3]=0,t[4]=R,t[5]=D,t[6]=q,t[7]=0,t[8]=C,t[9]=j,t[10]=N,t[11]=0,t[12]=n[0]+w-(T*w+R*P+C*S),t[13]=n[1]+P-(O*w+D*P+j*S),t[14]=n[2]+S-(A*w+q*P+N*S),t[15]=1,t}function Pe(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n+n,s=r+r,u=a+a,c=n*o,h=r*o,f=r*s,l=a*o,d=a*s,v=a*u,m=i*o,p=i*s,M=i*u;return t[0]=1-f-v,t[1]=h+M,t[2]=l-p,t[3]=0,t[4]=h-M,t[5]=1-c-v,t[6]=d+m,t[7]=0,t[8]=l+p,t[9]=d-m,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Se(t,e,n,r,a,i,o){var s=1/(n-e),u=1/(a-r),c=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(a+r)*u,t[10]=(o+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*c,t[15]=0,t}function Te(t,e,n,r,a){var i,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(i=1/(r-a),t[10]=(a+r)*i,t[14]=2*a*r*i):(t[10]=-1,t[14]=-2*r),t}var Oe=Te;function Ae(t,e,n,r,a){var i,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(i=1/(r-a),t[10]=a*i,t[14]=a*r*i):(t[10]=-1,t[14]=-r),t}function Re(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(a+i);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(a-i)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function De(t,e,n,r,a,i,o){var s=1/(e-n),u=1/(r-a),c=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*u,t[14]=(o+i)*c,t[15]=1,t}var qe=De;function Ce(t,e,n,r,a,i,o){var s=1/(e-n),u=1/(r-a),c=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*u,t[14]=i*c,t[15]=1,t}function je(t,e,n,r){var a,i,o,s,u,c,h,f,l,v,m=e[0],p=e[1],M=e[2],_=r[0],b=r[1],g=r[2],y=n[0],x=n[1],E=n[2];return Math.abs(m-y)<d&&Math.abs(p-x)<d&&Math.abs(M-E)<d?te(t):(h=m-y,f=p-x,l=M-E,a=b*(l*=v=1/Math.hypot(h,f,l))-g*(f*=v),i=g*(h*=v)-_*l,o=_*f-b*h,(v=Math.hypot(a,i,o))?(a*=v=1/v,i*=v,o*=v):(a=0,i=0,o=0),s=f*o-l*i,u=l*a-h*o,c=h*i-f*a,(v=Math.hypot(s,u,c))?(s*=v=1/v,u*=v,c*=v):(s=0,u=0,c=0),t[0]=a,t[1]=s,t[2]=h,t[3]=0,t[4]=i,t[5]=u,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=l,t[11]=0,t[12]=-(a*m+i*p+o*M),t[13]=-(s*m+u*p+c*M),t[14]=-(h*m+f*p+l*M),t[15]=1,t)}function Ne(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=r[0],u=r[1],c=r[2],h=a-n[0],f=i-n[1],l=o-n[2],d=h*h+f*f+l*l;d>0&&(h*=d=1/Math.sqrt(d),f*=d,l*=d);var v=u*l-c*f,m=c*h-s*l,p=s*f-u*h;return(d=v*v+m*m+p*p)>0&&(v*=d=1/Math.sqrt(d),m*=d,p*=d),t[0]=v,t[1]=m,t[2]=p,t[3]=0,t[4]=f*p-l*m,t[5]=l*v-h*p,t[6]=h*m-f*v,t[7]=0,t[8]=h,t[9]=f,t[10]=l,t[11]=0,t[12]=a,t[13]=i,t[14]=o,t[15]=1,t}function ke(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ue(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Le(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Ie(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Ge(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Fe(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function ze(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Ve(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=t[9],l=t[10],v=t[11],m=t[12],p=t[13],M=t[14],_=t[15],b=e[0],g=e[1],y=e[2],x=e[3],E=e[4],w=e[5],P=e[6],S=e[7],T=e[8],O=e[9],A=e[10],R=e[11],D=e[12],q=e[13],C=e[14],j=e[15];return Math.abs(n-b)<=d*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-g)<=d*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-y)<=d*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(i-x)<=d*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-E)<=d*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-w)<=d*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-P)<=d*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(c-S)<=d*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=d*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-O)<=d*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(l-A)<=d*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(v-R)<=d*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(m-D)<=d*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(p-q)<=d*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(M-C)<=d*Math.max(1,Math.abs(M),Math.abs(C))&&Math.abs(_-j)<=d*Math.max(1,Math.abs(_),Math.abs(j))}var Be=ie,Xe=Ie;function Ye(){var t=new v(3);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function We(t){var e=new v(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ze(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function He(t,e,n){var r=new v(3);return r[0]=t,r[1]=e,r[2]=n,r}function Qe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $e(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Je(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ke(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function tn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function en(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function nn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function rn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function an(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function on(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function sn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function un(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function cn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function hn(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function fn(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return n*n+r*r+a*a}function ln(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function dn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function vn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function mn(t,e){var n=e[0],r=e[1],a=e[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function pn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Mn(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[0],s=n[1],u=n[2];return t[0]=a*u-i*s,t[1]=i*o-r*u,t[2]=r*s-a*o,t}function _n(t,e,n,r){var a=e[0],i=e[1],o=e[2];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t}function bn(t,e,n,r,a,i){var o=i*i,s=o*(2*i-3)+1,u=o*(i-2)+i,c=o*(i-1),h=o*(3-2*i);return t[0]=e[0]*s+n[0]*u+r[0]*c+a[0]*h,t[1]=e[1]*s+n[1]*u+r[1]*c+a[1]*h,t[2]=e[2]*s+n[2]*u+r[2]*c+a[2]*h,t}function gn(t,e,n,r,a,i){var o=1-i,s=o*o,u=i*i,c=s*o,h=3*i*s,f=3*u*o,l=u*i;return t[0]=e[0]*c+n[0]*h+r[0]*f+a[0]*l,t[1]=e[1]*c+n[1]*h+r[1]*f+a[1]*l,t[2]=e[2]*c+n[2]*h+r[2]*f+a[2]*l,t}function yn(t,e){e=e||1;var n=2*m()*Math.PI,r=2*m()-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t}function xn(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,t[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,t[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,t}function En(t,e,n){var r=e[0],a=e[1],i=e[2];return t[0]=r*n[0]+a*n[3]+i*n[6],t[1]=r*n[1]+a*n[4]+i*n[7],t[2]=r*n[2]+a*n[5]+i*n[8],t}function wn(t,e,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=e[0],u=e[1],c=e[2],h=a*c-i*u,f=i*s-r*c,l=r*u-a*s,d=a*l-i*f,v=i*h-r*l,m=r*f-a*h,p=2*o;return h*=p,f*=p,l*=p,d*=2,v*=2,m*=2,t[0]=s+h+d,t[1]=u+f+v,t[2]=c+l+m,t}function Pn(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Sn(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Tn(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function On(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],o=e[1],s=e[2],u=Math.sqrt(n*n+r*r+a*a)*Math.sqrt(i*i+o*o+s*s),c=u&&pn(t,e)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function An(t){return t[0]=0,t[1]=0,t[2]=0,t}function Rn(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Dn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function qn(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],o=e[1],s=e[2];return Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-s)<=d*Math.max(1,Math.abs(a),Math.abs(s))}var Cn,jn=Ke,Nn=tn,kn=en,Un=hn,Ln=fn,In=Ze,Gn=ln,Fn=(Cn=Ye(),function(t,e,n,r,a,i){var o,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,o=n;o<s;o+=e)Cn[0]=t[o],Cn[1]=t[o+1],Cn[2]=t[o+2],a(Cn,Cn,i),t[o]=Cn[0],t[o+1]=Cn[1],t[o+2]=Cn[2];return t});function zn(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Vn(t){var e=new v(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Bn(t,e,n,r){var a=new v(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function Xn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Yn(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t}function Wn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Zn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Hn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Qn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function $n(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Jn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Kn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function tr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function er(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function nr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function rr(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function ar(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return Math.hypot(n,r,a,i)}function ir(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return n*n+r*r+a*a+i*i}function or(t){var e=t[0],n=t[1],r=t[2],a=t[3];return Math.hypot(e,n,r,a)}function sr(t){var e=t[0],n=t[1],r=t[2],a=t[3];return e*e+n*n+r*r+a*a}function ur(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function hr(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=a*o,t[3]=i*o,t}function fr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function lr(t,e,n,r){var a=n[0]*r[1]-n[1]*r[0],i=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],h=e[0],f=e[1],l=e[2],d=e[3];return t[0]=f*c-l*u+d*s,t[1]=-h*c+l*o-d*i,t[2]=h*u-f*o+d*a,t[3]=-h*s+f*i-l*a,t}function dr(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=e[3];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t[3]=s+r*(n[3]-s),t}function vr(t,e){var n,r,a,i,o,s;e=e||1;do{o=(n=2*m()-1)*n+(r=2*m()-1)*r}while(o>=1);do{s=(a=2*m()-1)*a+(i=2*m()-1)*i}while(s>=1);var u=Math.sqrt((1-o)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*a*u,t[3]=e*i*u,t}function mr(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*o,t}function pr(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[0],s=n[1],u=n[2],c=n[3],h=c*r+s*i-u*a,f=c*a+u*r-o*i,l=c*i+o*a-s*r,d=-o*r-s*a-u*i;return t[0]=h*c+d*-o+f*-u-l*-s,t[1]=f*c+d*-s+l*-o-h*-u,t[2]=l*c+d*-u+h*-s-f*-o,t[3]=e[3],t}function Mr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function _r(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function br(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function gr(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-o)<=d*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-u)<=d*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))}var yr=Zn,xr=Hn,Er=Qn,wr=ar,Pr=ir,Sr=or,Tr=sr,Or=function(){var t=zn();return function(e,n,r,a,i,o){var s,u;for(n||(n=4),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function Ar(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Rr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Dr(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function qr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>d?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Cr(t,e){var n=ua(t,e);return Math.acos(2*n*n-1)}function jr(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+o*s+a*c-i*u,t[1]=a*h+o*u+i*s-r*c,t[2]=i*h+o*c+r*u-a*s,t[3]=o*h-r*s-a*u-i*c,t}function Nr(t,e,n){n*=.5;var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=a*u+i*s,t[2]=i*u-a*s,t[3]=o*u-r*s,t}function kr(t,e,n){n*=.5;var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-i*s,t[1]=a*u+o*s,t[2]=i*u+r*s,t[3]=o*u-a*s,t}function Ur(t,e,n){n*=.5;var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=a*u-r*s,t[2]=i*u+o*s,t[3]=o*u-i*s,t}function Lr(t,e){var n=e[0],r=e[1],a=e[2];return t[0]=n,t[1]=r,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),t}function Ir(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=Math.sqrt(n*n+r*r+a*a),s=Math.exp(i),u=o>0?s*Math.sin(o)/o:0;return t[0]=n*u,t[1]=r*u,t[2]=a*u,t[3]=s*Math.cos(o),t}function Gr(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=Math.sqrt(n*n+r*r+a*a),s=o>0?Math.atan2(o,i)/o:0;return t[0]=n*s,t[1]=r*s,t[2]=a*s,t[3]=.5*Math.log(n*n+r*r+a*a+i*i),t}function Fr(t,e,n){return Gr(t,e),sa(t,t,n),Ir(t,t),t}function zr(t,e,n,r){var a,i,o,s,u,c=e[0],h=e[1],f=e[2],l=e[3],v=n[0],m=n[1],p=n[2],M=n[3];return(i=c*v+h*m+f*p+l*M)<0&&(i=-i,v=-v,m=-m,p=-p,M=-M),1-i>d?(a=Math.acos(i),o=Math.sin(a),s=Math.sin((1-r)*a)/o,u=Math.sin(r*a)/o):(s=1-r,u=r),t[0]=s*c+u*v,t[1]=s*h+u*m,t[2]=s*f+u*p,t[3]=s*l+u*M,t}function Vr(t){var e=m(),n=m(),r=m(),a=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=i*Math.sin(2*Math.PI*r),t[3]=i*Math.cos(2*Math.PI*r),t}function Br(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n*n+r*r+a*a+i*i,s=o?1/o:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-a*s,t[3]=i*s,t}function Xr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Yr(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(e[3*a+a]-e[3*i+i]-e[3*o+o]+1),t[a]=.5*n,n=.5/n,t[3]=(e[3*i+o]-e[3*o+i])*n,t[i]=(e[3*i+a]+e[3*a+i])*n,t[o]=(e[3*o+a]+e[3*a+o])*n}return t}function Wr(t,e,n,r){var a=.5*Math.PI/180;e*=a,n*=a,r*=a;var i=Math.sin(e),o=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),h=Math.cos(r);return t[0]=i*u*h-o*s*c,t[1]=o*s*h+i*u*c,t[2]=o*u*c-i*s*h,t[3]=o*u*h+i*s*c,t}function Zr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Hr,Qr,$r,Jr,Kr,ta,ea=Vn,na=Bn,ra=Xn,aa=Yn,ia=Wn,oa=jr,sa=nr,ua=fr,ca=dr,ha=or,fa=ha,la=sr,da=la,va=hr,ma=br,pa=gr,Ma=(Hr=Ye(),Qr=He(1,0,0),$r=He(0,1,0),function(t,e,n){var r=pn(e,n);return r<-.999999?(Mn(Hr,Qr,e),In(Hr)<1e-6&&Mn(Hr,$r,e),mn(Hr,Hr),Dr(t,Hr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Mn(Hr,e,n),t[0]=Hr[0],t[1]=Hr[1],t[2]=Hr[2],t[3]=1+r,va(t,t))}),_a=(Jr=Ar(),Kr=Ar(),function(t,e,n,r,a,i){return zr(Jr,e,a,i),zr(Kr,n,r,i),zr(t,Jr,Kr,2*i*(1-i)),t}),ba=(ta=Mt(),function(t,e,n,r){return ta[0]=n[0],ta[3]=n[1],ta[6]=n[2],ta[1]=r[0],ta[4]=r[1],ta[7]=r[2],ta[2]=-e[0],ta[5]=-e[1],ta[8]=-e[2],va(t,Yr(t,ta))});function ga(){var t=new v(8);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function ya(t){var e=new v(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function xa(t,e,n,r,a,i,o,s){var u=new v(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=a,u[5]=i,u[6]=o,u[7]=s,u}function Ea(t,e,n,r,a,i,o){var s=new v(8);s[0]=t,s[1]=e,s[2]=n,s[3]=r;var u=.5*a,c=.5*i,h=.5*o;return s[4]=u*r+c*n-h*e,s[5]=c*r+h*t-u*n,s[6]=h*r+u*e-c*t,s[7]=-u*t-c*e-h*n,s}function wa(t,e,n){var r=.5*n[0],a=.5*n[1],i=.5*n[2],o=e[0],s=e[1],u=e[2],c=e[3];return t[0]=o,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+a*u-i*s,t[5]=a*c+i*o-r*u,t[6]=i*c+r*s-a*o,t[7]=-r*o-a*s-i*u,t}function Pa(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Sa(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ta(t,e){var n=Ar();xe(n,e);var r=new v(3);return ge(r,e),wa(t,n,r),t}function Oa(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Aa(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ra(t,e,n,r,a,i,o,s,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=u,t}var Da=ra;function qa(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Ca=ra;function ja(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Na(t,e){var n=e[4],r=e[5],a=e[6],i=e[7],o=-e[0],s=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+i*o+r*u-a*s),t[1]=2*(r*c+i*s+a*o-n*u),t[2]=2*(a*c+i*u+n*s-r*o),t}function ka(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=.5*n[0],u=.5*n[1],c=.5*n[2],h=e[4],f=e[5],l=e[6],d=e[7];return t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=o*s+a*c-i*u+h,t[5]=o*u+i*s-r*c+f,t[6]=o*c+r*u-a*s+l,t[7]=-r*s-a*u-i*c+d,t}function Ua(t,e,n){var r=-e[0],a=-e[1],i=-e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*o+h*r+u*i-c*a,l=u*o+h*a+c*r-s*i,d=c*o+h*i+s*a-u*r,v=h*o-s*r-u*a-c*i;return Nr(t,e,n),r=t[0],a=t[1],i=t[2],o=t[3],t[4]=f*o+v*r+l*i-d*a,t[5]=l*o+v*a+d*r-f*i,t[6]=d*o+v*i+f*a-l*r,t[7]=v*o-f*r-l*a-d*i,t}function La(t,e,n){var r=-e[0],a=-e[1],i=-e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*o+h*r+u*i-c*a,l=u*o+h*a+c*r-s*i,d=c*o+h*i+s*a-u*r,v=h*o-s*r-u*a-c*i;return kr(t,e,n),r=t[0],a=t[1],i=t[2],o=t[3],t[4]=f*o+v*r+l*i-d*a,t[5]=l*o+v*a+d*r-f*i,t[6]=d*o+v*i+f*a-l*r,t[7]=v*o-f*r-l*a-d*i,t}function Ia(t,e,n){var r=-e[0],a=-e[1],i=-e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],f=s*o+h*r+u*i-c*a,l=u*o+h*a+c*r-s*i,d=c*o+h*i+s*a-u*r,v=h*o-s*r-u*a-c*i;return Ur(t,e,n),r=t[0],a=t[1],i=t[2],o=t[3],t[4]=f*o+v*r+l*i-d*a,t[5]=l*o+v*a+d*r-f*i,t[6]=d*o+v*i+f*a-l*r,t[7]=v*o-f*r-l*a-d*i,t}function Ga(t,e,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=s*o+h*r+u*i-c*a,t[1]=u*o+h*a+c*r-s*i,t[2]=c*o+h*i+s*a-u*r,t[3]=h*o-s*r-u*a-c*i,s=e[4],u=e[5],c=e[6],h=e[7],t[4]=s*o+h*r+u*i-c*a,t[5]=u*o+h*a+c*r-s*i,t[6]=c*o+h*i+s*a-u*r,t[7]=h*o-s*r-u*a-c*i,t}function Fa(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+o*s+a*c-i*u,t[1]=a*h+o*u+i*s-r*c,t[2]=i*h+o*c+r*u-a*s,t[3]=o*h-r*s-a*u-i*c,s=n[4],u=n[5],c=n[6],h=n[7],t[4]=r*h+o*s+a*c-i*u,t[5]=a*h+o*u+i*s-r*c,t[6]=i*h+o*c+r*u-a*s,t[7]=o*h-r*s-a*u-i*c,t}function za(t,e,n,r){if(Math.abs(r)<d)return Oa(t,e);var a=Math.hypot(n[0],n[1],n[2]);r*=.5;var i=Math.sin(r),o=i*n[0]/a,s=i*n[1]/a,u=i*n[2]/a,c=Math.cos(r),h=e[0],f=e[1],l=e[2],v=e[3];t[0]=h*c+v*o+f*u-l*s,t[1]=f*c+v*s+l*o-h*u,t[2]=l*c+v*u+h*s-f*o,t[3]=v*c-h*o-f*s-l*u;var m=e[4],p=e[5],M=e[6],_=e[7];return t[4]=m*c+_*o+p*u-M*s,t[5]=p*c+_*s+M*o-m*u,t[6]=M*c+_*u+m*s-p*o,t[7]=_*c-m*o-p*s-M*u,t}function Va(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Ba(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[4],u=n[5],c=n[6],h=n[7],f=e[4],l=e[5],d=e[6],v=e[7],m=n[0],p=n[1],M=n[2],_=n[3];return t[0]=r*_+o*m+a*M-i*p,t[1]=a*_+o*p+i*m-r*M,t[2]=i*_+o*M+r*p-a*m,t[3]=o*_-r*m-a*p-i*M,t[4]=r*h+o*s+a*c-i*u+f*_+v*m+l*M-d*p,t[5]=a*h+o*u+i*s-r*c+l*_+v*p+d*m-f*M,t[6]=i*h+o*c+r*u-a*s+d*_+v*M+f*p-l*m,t[7]=o*h-r*s-a*u-i*c+v*_-f*m-l*p-d*M,t}var Xa=Ba;function Ya(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var Wa=ua;function Za(t,e,n,r){var a=1-r;return Wa(e,n)<0&&(r=-r),t[0]=e[0]*a+n[0]*r,t[1]=e[1]*a+n[1]*r,t[2]=e[2]*a+n[2]*r,t[3]=e[3]*a+n[3]*r,t[4]=e[4]*a+n[4]*r,t[5]=e[5]*a+n[5]*r,t[6]=e[6]*a+n[6]*r,t[7]=e[7]*a+n[7]*r,t}function Ha(t,e){var n=Ka(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Qa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var $a=ha,Ja=$a,Ka=la,ti=Ka;function ei(t,e){var n=Ka(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,a=e[1]/n,i=e[2]/n,o=e[3]/n,s=e[4],u=e[5],c=e[6],h=e[7],f=r*s+a*u+i*c+o*h;t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=(s-r*f)/n,t[5]=(u-a*f)/n,t[6]=(c-i*f)/n,t[7]=(h-o*f)/n}return t}function ni(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function ri(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ai(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],h=e[0],f=e[1],l=e[2],v=e[3],m=e[4],p=e[5],M=e[6],_=e[7];return Math.abs(n-h)<=d*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-l)<=d*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-v)<=d*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(o-m)<=d*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-p)<=d*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-M)<=d*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-_)<=d*Math.max(1,Math.abs(c),Math.abs(_))}function ii(){var t=new v(2);return v!=Float32Array&&(t[0]=0,t[1]=0),t}function oi(t){var e=new v(2);return e[0]=t[0],e[1]=t[1],e}function si(t,e){var n=new v(2);return n[0]=t,n[1]=e,n}function ui(t,e){return t[0]=e[0],t[1]=e[1],t}function ci(t,e,n){return t[0]=e,t[1]=n,t}function hi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function fi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function li(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function di(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function vi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function mi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function pi(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Mi(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function _i(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function bi(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function gi(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function yi(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function xi(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Ei(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function wi(t){var e=t[0],n=t[1];return e*e+n*n}function Pi(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Si(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Ti(t,e){var n=e[0],r=e[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t}function Oi(t,e){return t[0]*e[0]+t[1]*e[1]}function Ai(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Ri(t,e,n,r){var a=e[0],i=e[1];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t}function Di(t,e){e=e||1;var n=2*m()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function qi(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a,t[1]=n[1]*r+n[3]*a,t}function Ci(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a+n[4],t[1]=n[1]*r+n[3]*a+n[5],t}function ji(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[3]*a+n[6],t[1]=n[1]*r+n[4]*a+n[7],t}function Ni(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[4]*a+n[12],t[1]=n[1]*r+n[5]*a+n[13],t}function ki(t,e,n,r){var a=e[0]-n[0],i=e[1]-n[1],o=Math.sin(r),s=Math.cos(r);return t[0]=a*s-i*o+n[0],t[1]=a*o+i*s+n[1],t}function Ui(t,e){var n=t[0],r=t[1],a=e[0],i=e[1],o=Math.sqrt(n*n+r*r)*Math.sqrt(a*a+i*i),s=o&&(n*a+r*i)/o;return Math.acos(Math.min(Math.max(s,-1),1))}function Li(t){return t[0]=0,t[1]=0,t}function Ii(t){return"vec2("+t[0]+", "+t[1]+")"}function Gi(t,e){return t[0]===e[0]&&t[1]===e[1]}function Fi(t,e){var n=t[0],r=t[1],a=e[0],i=e[1];return Math.abs(n-a)<=d*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=d*Math.max(1,Math.abs(r),Math.abs(i))}var zi=Ei,Vi=fi,Bi=li,Xi=di,Yi=yi,Wi=xi,Zi=wi,Hi=function(){var t=ii();return function(e,n,r,a,i,o){var s,u;for(n||(n=2),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],i(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}()},490:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))},a=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const i=n(72),o=n(248),s=n(382);var u;!function(t){t[t.ROTATE_ORIGIN=0]="ROTATE_ORIGIN",t[t.FREE=1]="FREE",t[t.FIXED=2]="FIXED"}(u||(u={}));class c extends o.SceneObject{constructor(t){var{look_at_target:e}=t;super(a(t,["look_at_target"])),this.up=i.vec3.fromValues(0,1,0),this.look_at_target=i.vec3.create(),this.movement_mode=u.ROTATE_ORIGIN,this.rotation_speed=.01,this.movement_speed=.01,this.mouse_sensitivity=.001,this.look_at=t=>{this.look_at_target=t},this.get_camera_forward=()=>i.vec3.normalize(i.vec3.create(),i.vec3.subtract(i.vec3.create(),this.look_at_target,this.position)),this.get_camera_right=()=>i.vec3.normalize(i.vec3.create(),i.vec3.cross(i.vec3.create(),this.get_camera_forward(),this.up)),this.get_view_matrix=()=>{const t=i.mat4.create();return i.mat4.translate(t,t,this.position),i.mat4.lookAt(t,this.position,this.look_at_target,this.up),t},this.get_projection_matrix=t=>{t||(t=window.innerWidth/window.innerHeight);const e=i.mat4.create();return i.mat4.perspective(e,Math.PI/4,t,.1,1e3),e},this.update=t=>r(this,void 0,void 0,(function*(){const{key_press:e,key_state:n,mouse_state:r}=s.SystemCore.system_input,{canvas:a}=t;if(e.get("`")&&(console.log("toggling camera mode"),this.movement_mode===u.ROTATE_ORIGIN?(this.movement_mode=u.FREE,null==a||a.requestPointerLock()):this.movement_mode===u.FREE?(document.exitPointerLock(),this.movement_mode=u.FIXED):this.movement_mode===u.FIXED&&(this.movement_mode=u.ROTATE_ORIGIN)),this.movement_mode===u.ROTATE_ORIGIN){if(n.get("a")||n.get("d")){const t=n.get("a")?this.rotation_speed:-this.rotation_speed,e=i.mat4.create();i.mat4.translate(e,e,this.look_at_target),i.mat4.rotateY(e,e,t),i.mat4.translate(e,e,i.vec3.negate(i.vec3.create(),this.look_at_target)),i.vec3.transformMat4(this.position,this.position,e)}}else if(this.movement_mode===u.FREE){if(r.dx||r.dy){this.get_camera_forward();const t=this.get_camera_right(),e=r.dx*this.mouse_sensitivity,n=r.dy*this.mouse_sensitivity,a=i.mat4.create();i.mat4.rotate(a,a,-e,this.up),i.mat4.rotate(a,a,-n,t),i.vec3.transformMat4(this.position,this.position,a);const o=this.get_camera_forward();this.get_camera_right(),i.vec3.add(this.look_at_target,this.position,o)}if(n.get("w")||n.get("s")){const t=n.get("w")?this.movement_speed:-this.movement_speed,e=this.get_camera_forward();i.vec3.scale(e,e,t),i.vec3.add(this.position,this.position,e),i.vec3.add(this.look_at_target,this.look_at_target,e)}if(n.get("a")||n.get("d")){const t=n.get("a")?-this.movement_speed:this.movement_speed,e=this.get_camera_right();i.vec3.scale(e,e,t),i.vec3.add(this.position,this.position,e),i.vec3.add(this.look_at_target,this.look_at_target,e)}}else this.movement_mode,u.FIXED})),this.look_at(e||i.vec3.create())}}e.Camera=c},50:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ComputeObject=void 0;const r=n(248);class a extends r.SceneObject{constructor(t){var e,n;super(t),this.parse_workgroup_size=(t,e,n)=>{if("string"!=typeof t)return t;switch(t){case"canvas_width":return e;case"canvas_height":return n;default:return 1}};const r=(null===(e=t.scene.canvas)||void 0===e?void 0:e.width)||1,a=(null===(n=t.scene.canvas)||void 0===n?void 0:n.height)||1;this.workgroup_size=[this.parse_workgroup_size(t.workgroup_size[0],r,a),this.parse_workgroup_size(t.workgroup_size[1],r,a),this.parse_workgroup_size(t.workgroup_size[2],r,a)]}}e.ComputeObject=a},975:function(t,e,n){var r=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Light=void 0;const a=n(72),i=n(248);class o extends i.SceneObject{constructor(t){var{color:e=a.vec3.fromValues(1,1,1),intensity:n=1}=t;super(r(t,["color","intensity"])),this.get_uniform_data=()=>({position:[...this.position,0],color:this.color}),this.color=a.vec4.fromValues(e[0],e[1],e[2],n)}}e.Light=o},818:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.models=e.load_model=void 0;const a=n(72),i=n(779),o={};e.models=o,e.load_model=t=>r(void 0,void 0,void 0,(function*(){if(!t)return;if(o[t])return;console.log("Loading model",t);const e=yield fetch(t),n=yield e.text(),r=[],s=[],u=[],c=[];let h=a.vec4.create(),f=a.vec4.create();n.split("\n").forEach((t=>{const e=t.split(" "),n=e[0];if("v"===n){const t=a.vec4.fromValues(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),1);h[0]=Math.max(h[0],t[0]),h[1]=Math.max(h[1],t[1]),h[2]=Math.max(h[2],t[2]),f[0]=Math.min(f[0],t[0]),f[1]=Math.min(f[1],t[1]),f[2]=Math.min(f[2],t[2]),r.push(t)}else if("vn"===n){const t=a.vec4.fromValues(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),0);s.push(t)}else if("vt"===n){const t=a.vec4.fromValues(parseFloat(e[1]),parseFloat(e[2]),0,0);u.push(t)}else"f"===n&&(c.push(e[1]),c.push(e[2]),c.push(e[3]))})),f[0],h[0],f[0],f[1],h[1],f[1],f[2],h[2],f[2];const l=[],d=new Map;let v=[];c.forEach((t=>{if(!d.has(t)){const e=t.split("/").filter((t=>""!==t)),n=parseInt(e[0])-1,i=parseInt(e[1])-1,o=parseInt(e[2])-1;v.push(r[n]),v.push(u[i]||a.vec4.create()),v.push(s[o]||a.vec4.create());const c=d.size;d.set(t,c)}l.push(d.get(t))}));const m=v.flatMap((t=>[...t])),p={vertex_data_gpu:(0,i.create_gpu_buffer)(new Float32Array(m)),indices_gpu:(0,i.create_gpu_buffer)(new Int32Array(l),GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST),index_count:l.length};o[t]=p}))},196:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Default2DComputePipeLine=void 0;const a=n(382),i=n(267);class o extends i.PipeLine{static get_pipeline_label(){return"default_2d_compute"}static construct_pipeline(t,e){return r(this,void 0,void 0,(function*(){const n=yield e.shader_manager.get_shader(t),{device:r}=a.SystemCore,i=r.createShaderModule({code:n}),s=r.createComputePipeline({layout:"auto",compute:{module:i,entryPoint:"main"}});return new o(t,s)}))}render(t){return r(this,void 0,void 0,(function*(){const e=o.get_pipeline_key(this.shader_path),n=t.objects.filter((t=>t.pipeline_key===e));if(0===n.length||!t.texture_view)return;const r=a.SystemCore.command_encoder.beginComputePass();r.setPipeline(this.gpu_pipeline);const i={layout:this.gpu_pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:t.texture_view}]};r.setBindGroup(0,a.SystemCore.device.createBindGroup(i)),n.forEach((t=>{const e=t;r.dispatchWorkgroups(e.workgroup_size[0],e.workgroup_size[1],e.workgroup_size[2])})),r.end()}))}}e.Default2DComputePipeLine=o},705:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Default3DPipeLine=void 0;const a=n(779),i=n(382),o=n(267),s={entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:5,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]};class u extends o.PipeLine{static get_pipeline_label(){return"default_3d"}static construct_pipeline(t,e){return r(this,void 0,void 0,(function*(){const{shader_manager:n}=e,r=yield n.get_shader(t),{device:o}=i.SystemCore,{presentation_format:c}=e,h=o.createShaderModule({code:r}),f=o.createBindGroupLayout(s),l=o.createRenderPipeline({label:"default_3d",layout:o.createPipelineLayout({bindGroupLayouts:[f]}),vertex:{module:h,buffers:[{arrayStride:48,attributes:[{shaderLocation:0,offset:0,format:"float32x4"},{shaderLocation:1,offset:16,format:"float32x4"},{shaderLocation:2,offset:32,format:"float32x4"}]}]},fragment:{module:h,targets:[{format:c}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),d=new u(t,l);return d.uniform_buffer=(0,a.create_gpu_buffer)(new Float32Array(116),GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),d}))}render(t){return r(this,void 0,void 0,(function*(){var e,n,r;const{device:o,command_encoder:s}=i.SystemCore,{texture_manager:c,texture_view:h,depth_texture_view:f}=t,l=u.get_pipeline_key(this.shader_path),d=t.objects.filter((t=>t.pipeline_key===l));if(0===d.length||!h||!f)return;const v=s.beginRenderPass({colorAttachments:[{view:h,clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:f,depthClearValue:1,stencilClearValue:0,depthLoadOp:"clear",depthStoreOp:"store"}});v.setPipeline(this.gpu_pipeline);const m=d[0],p=m.has_texture_diffuse()?1:0,M=m.has_texture_specular()?1:0,_=m.has_texture_normal()?1:0,b=yield c.load_texture(m.texture_diffuse),g=yield c.load_texture(m.texture_specular),y=yield c.load_texture(m.texture_normal),x=new Float32Array(d.flatMap((t=>[...t.get_model_matrix()])));16*d.length*4>(null!==(n=null===(e=this.model_transforms)||void 0===e?void 0:e.size)&&void 0!==n?n:0)?(null===(r=this.model_transforms)||void 0===r||r.destroy(),this.model_transforms=(0,a.create_gpu_buffer)(x,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST)):o.queue.writeBuffer(this.model_transforms,0,x);const E=new Float32Array([p,M,_,t.lights.length,...t.camera.get_view_matrix(),...t.camera.get_projection_matrix(),...t.lights.reduce(((t,e)=>t.concat([...e.position,0,...e.color])),[])]);o.queue.writeBuffer(this.uniform_buffer,0,E);const w={layout:this.gpu_pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniform_buffer,offset:0,size:this.uniform_buffer.size}},{binding:1,resource:o.createSampler({})},{binding:2,resource:b.createView()},{binding:3,resource:g.createView()},{binding:4,resource:y.createView()},{binding:5,resource:{buffer:this.model_transforms,offset:0,size:this.model_transforms.size}}]};v.setBindGroup(0,o.createBindGroup(w));const{vertex_data_gpu:P,indices_gpu:S,index_count:T}=yield m.get_model_data();v.setVertexBuffer(0,P),v.setIndexBuffer(S,"uint32"),v.drawIndexed(T,d.length,0,0,0),v.end()}))}}e.Default3DPipeLine=u},267:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.PipeLine=void 0,e.PipeLine=class{constructor(t,e,n=0){this.shader_path=t,this.order=n,this.gpu_pipeline=e}static get_pipeline_key(t){return`${t}+${this.get_pipeline_label()}`}static get_pipeline_label(){throw new Error("Please return a unique label for your pipeline from get_pipeline_label")}static construct_pipeline(t,e){return n(this,void 0,void 0,(function*(){throw new Error("Please implement logic for creating your pipeline, make sure to call super() so the pipeline is registered.")}))}}},223:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PipeLineManager=void 0,e.PipeLineManager=class{constructor(){this.registered_pipelines=new Map,this.register_pipeline=(t,e,n)=>{const r=t.get_pipeline_key(e);this.registered_pipelines.has(r)||t.construct_pipeline(e,n).then((t=>{this.registered_pipelines.set(r,t)}))},this.get_registered_pipeline=t=>this.registered_pipelines.get(t)}}},776:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.registered_pipeline_types=void 0;const r=n(196),a=n(705),i={Default2DComputePipeLine:r.Default2DComputePipeLine,Default3DPipeLine:a.Default3DPipeLine};e.registered_pipeline_types=i},20:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderManager=void 0,e.ShaderManager=class{constructor(){this.shaders=new Map,this.get_shader=t=>n(this,void 0,void 0,(function*(){if(!this.shaders.has(t)){const e=yield fetch(t);this.shaders.set(t,yield e.text())}return this.shaders.get(t)})),this.get_registered_shader=t=>this.shaders.get(t)}}},374:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))},a=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const i=n(490),o=n(975),s=n(223),u=n(20),c=n(70),h=n(623),f=n(382),l=n(786),d=n(61),v=n(776);e.Scene=class{constructor(t="",e="canvas"){this.active=!0,this.current_frame=0,this.event_system=new h.GameEventSystem,this.texture_manager=new l.TextureManager,this.pipeline_manager=new s.PipeLineManager,this.shader_manager=new u.ShaderManager,this.presentation_format="rgba8unorm",this.lights=[],this.camera=new i.Camera({id:"-1",name:"camera",scene:this}),this.objects=[],this.load_scene=(t,e)=>r(this,void 0,void 0,(function*(){console.log(`Loading scene from: ${t}`);try{const n=yield fetch(t),r=yield n.json(),s=r.canvas||"canvas";if(this.canvas=document.getElementById(s),this.resize_scene(),!this.canvas)throw alert("Canvas not found"),new Error("Canvas not found");const u=this.canvas.getContext("webgpu");if(!u)throw alert("WebGPU not supported"),new Error("WebGPU not supported");u.configure({device:f.SystemCore.device,format:this.presentation_format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING}),r.objects.forEach((t=>{const{type:n,pipeline:r}=t,s=a(t,["type","pipeline"]),u=d.registered_scene_object_types[n];if(u){const t=new u(Object.assign(Object.assign({},s),{scene:this,pipeline:r&&v.registered_pipeline_types[r]}));t instanceof i.Camera?e.camera=t:t instanceof o.Light?e.add_light(t):e.add_object(t)}else console.error(`Unrecognized object type: ${n}, did you add it to the registered types file?`)}))}catch(t){console.error(`Error loading scene: ${t}`)}})),this.resize_scene=()=>{var t;const e=null===(t=this.canvas)||void 0===t?void 0:t.getBoundingClientRect();this.canvas&&e&&(this.canvas.width=e.width,this.canvas.height=e.height,this.depth_texture_view=f.SystemCore.device.createTexture({label:"Depth Texture",size:{width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}).createView())},this.add_light=t=>{this.lights.push(t)},this.add_object=t=>{this.objects.push(t),t.pipeline&&this.pipeline_manager.register_pipeline(t.pipeline,t.shader_path,this)},this.frame_start=()=>r(this,void 0,void 0,(function*(){var t;if(!this.active)return;const e=null===(t=this.canvas)||void 0===t?void 0:t.getContext("webgpu");e&&(this.texture_view=e.getCurrentTexture().createView(),yield this.event_system.publish(c.EventEnum.SCENE_FRAME_START))})),this.frame_end=()=>r(this,void 0,void 0,(function*(){this.current_frame++,yield this.event_system.publish(c.EventEnum.SCENE_FRAME_END)})),this.update=()=>r(this,void 0,void 0,(function*(){if(f.SystemCore.system_input.key_press.get("q")||!this.active)return this.active=!1,void console.log("Ending scene...");yield this.event_system.publish(c.EventEnum.SCENE_UPDATE_START);const t=[...this.objects,...this.lights,this.camera].map((t=>t.update(this)));yield Promise.all(t),yield this.event_system.publish(c.EventEnum.SCENE_UPDATE_END)})),this.render=()=>r(this,void 0,void 0,(function*(){yield this.event_system.publish(c.EventEnum.SCENE_RENDER_START);const t=Array.from(this.pipeline_manager.registered_pipelines.values()).reduce(((t,e)=>{const n=e.order;return t.has(n)||t.set(n,[]),t.get(n).push(e),t}),new Map),e=Array.from(t.keys()).sort();for(const n of e){const e=t.get(n).map((t=>t.render(this)));yield Promise.all(e)}yield this.event_system.publish(c.EventEnum.SCENE_RENDER_END)})),this.load_scene(t,this).then((()=>{window.addEventListener("resize",this.resize_scene),this.event_system.subscribe(c.EventEnum.SCENE_FRAME_START,this.update),this.event_system.subscribe(c.EventEnum.SCENE_UPDATE_END,this.render),this.event_system.subscribe(c.EventEnum.SCENE_RENDER_END,this.frame_end)}))}}},61:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.registered_scene_object_types=void 0;const r=n(490),a=n(50),i=n(975),o={SceneObject:n(248).SceneObject,Light:i.Light,Camera:r.Camera,ComputeObject:a.ComputeObject};e.registered_scene_object_types=o},248:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.SceneObject=void 0;const a=n(818),i=n(72);e.SceneObject=class{constructor({id:t,name:e,scene:n,model:o="",shader_path:s="",pipeline:u,position:c=i.vec3.create(),velocity:h=i.vec3.create(),rotation:f=i.vec3.create(),scale:l=i.vec3.fromValues(1,1,1),texture_diffuse:d,texture_specular:v,texture_normal:m,texture_emissive:p}){this.get_model_matrix=()=>{const t=i.mat4.create();return i.mat4.translate(t,t,this.position),i.mat4.rotateX(t,t,this.rotation[0]),i.mat4.rotateY(t,t,this.rotation[1]),i.mat4.rotateZ(t,t,this.rotation[2]),i.mat4.scale(t,t,this.scale),t},this.get_model_data=()=>r(this,void 0,void 0,(function*(){return yield(0,a.load_model)(this.model),a.models[this.model]})),this.has_texture_diffuse=()=>void 0!==this.texture_diffuse&&""!==this.texture_diffuse,this.has_texture_specular=()=>void 0!==this.texture_specular&&""!==this.texture_specular,this.has_texture_normal=()=>void 0!==this.texture_normal&&""!==this.texture_normal,this.has_texture_emissive=()=>void 0!==this.texture_emissive&&""!==this.texture_emissive,this.update=t=>r(this,void 0,void 0,(function*(){})),this.remove_from_scene=t=>{t.objects=t.objects.filter((t=>t!==this))},this.id=t,this.name=e,this.position=c,this.velocity=h,this.rotation=f,this.scale=l,this.model=o,this.texture_diffuse=d,this.texture_specular=v,this.texture_normal=m,this.texture_emissive=p,this.shader_path=s,this.pipeline=u,this.pipeline_key=(null==u?void 0:u.get_pipeline_key(s))||""}}},70:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.EventEnum=void 0,function(t){t[t.SCENE_FRAME_START=0]="SCENE_FRAME_START",t[t.SCENE_FRAME_END=1]="SCENE_FRAME_END",t[t.SCENE_UPDATE_START=2]="SCENE_UPDATE_START",t[t.SCENE_UPDATE_END=3]="SCENE_UPDATE_END",t[t.SCENE_RENDER_START=4]="SCENE_RENDER_START",t[t.SCENE_RENDER_END=5]="SCENE_RENDER_END"}(n||(e.EventEnum=n={}))},623:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.GameEventSystem=void 0,e.GameEventSystem=class{constructor(){this.events=new Map}subscribe(t,e){return this.events.has(t)||this.events.set(t,[]),this.events.get(t).includes(e)||this.events.get(t).push(e),e}unsubscribe(t,e){var n;const r=this.events.get(t),a=null!==(n=null==r?void 0:r.indexOf(e))&&void 0!==n?n:-1;a>=0&&r.splice(a,1)}publish(t){return n(this,arguments,void 0,(function*(t,e={}){if(!this.events.has(t))return;const n=this.events.get(t).map((t=>t(e)));yield Promise.all(n)}))}}},382:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.SystemCore=void 0;const a=n(374),i=n(693);class o{static start(){return r(this,void 0,void 0,(function*(){yield o.init_webgpu(),o.config=yield(yield fetch("./system_core_config.json")).json(),o.system_input=new i.SystemInputHandler,o.scenes.push(new a.Scene(o.config.start_scene)),console.log("SystemCore initialized, starting event loop..."),o.event_loop()}))}static init_webgpu(){return r(this,void 0,void 0,(function*(){var t;const e=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),n=yield null==e?void 0:e.requestDevice();if(!e||!n)throw alert("WebGPU not supported"),new Error("WebGPU not supported");o.adapter=e,o.device=n}))}static event_loop(){return r(this,void 0,void 0,(function*(){o.command_encoder=o.device.createCommandEncoder(),yield Promise.all(this.scenes.map((t=>t.frame_start()))),o.device.queue.submit([o.command_encoder.finish()]),requestAnimationFrame((()=>o.event_loop())),this.system_input.reset()}))}}e.SystemCore=o,o.scenes=[]},693:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SystemInputHandler=void 0,e.SystemInputHandler=class{constructor(){this.key_state=new Map,this.key_press=new Map,this.mouse_state={x:0,y:0,dx:0,dy:0,left:!1,right:!1,middle:!1,left_click:!1,right_click:!1,middle_click:!1},window.addEventListener("keydown",(t=>{this.key_state.set(t.key,!0)})),window.addEventListener("keyup",(t=>{this.key_state.set(t.key,!1)})),window.addEventListener("keypress",(t=>{this.key_press.set(t.key,!0)})),window.addEventListener("mousemove",(t=>{this.mouse_state.dx=t.movementX,this.mouse_state.dy=t.movementY,this.mouse_state.x=t.x,this.mouse_state.y=t.y})),window.addEventListener("mousedown",(t=>{0===t.button?this.mouse_state.left=!0:1===t.button?this.mouse_state.middle=!0:2===t.button&&(this.mouse_state.right=!0)})),window.addEventListener("mouseup",(t=>{0===t.button?this.mouse_state.left=!1:1===t.button?this.mouse_state.middle=!1:2===t.button&&(this.mouse_state.right=!1)})),window.addEventListener("click",(t=>{0===t.button?this.mouse_state.left_click=!0:1===t.button?this.mouse_state.middle_click=!0:2===t.button&&(this.mouse_state.right_click=!0)}))}reset(){this.key_state.clear(),this.key_press.clear(),this.mouse_state={x:0,y:0,dx:0,dy:0,left:!1,right:!1,middle:!1,left_click:!1,right_click:!1,middle_click:!1}}}},786:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TextureManager=void 0;const a=n(382);e.TextureManager=class{constructor(){this.textures={},this.empty_texture=this.get_default_texture()}get_default_texture(){return a.SystemCore.device.createTexture({size:[1,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST})}load_texture(t){return r(this,arguments,void 0,(function*(t,e="rgba8unorm"){if(void 0===t||""===t)return this.empty_texture;if(this.textures[t])return this.textures[t];const n=yield fetch(t),r=yield n.blob(),i=yield createImageBitmap(r,{colorSpaceConversion:"none"}),o=a.SystemCore.device.createTexture({label:t,format:e,size:[i.width,i.height],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return a.SystemCore.device.queue.copyExternalImageToTexture({source:i},{texture:o},[i.width,i.height]),this.textures[t]=o,o}))}}},779:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.create_gpu_buffer=void 0;const r=n(382);e.create_gpu_buffer=(t,e=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST)=>{const{device:n}=r.SystemCore,a=n.createBuffer({size:t.byteLength,usage:e,mappedAtCreation:!0}),i=a.getMappedRange();return new Uint8Array(i).set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),a.unmap(),a}}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(382),n(776),n(61)})();